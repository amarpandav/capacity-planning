<dialog class="bookingDialog" #bookingDialog>
    <div class="bookingDialogContainer">
        <h5>Save Bookings</h5>
        <ul>
            <li>You can book only available slots.</li>
            <li>You can't override someone else's booking</li>
            <li>You can't book when member is Absent or has Public holidays.</li>
        </ul>

        <div class="confirmation-actions">
            <button type="button" class="button btn btn-secondary" (click)="onBookingDialogCancel()">Cancel</button>
            <button type="button" class="button btn btn-primary" (click)="onBookingSave()">Save</button>
        </div>
    </div>
</dialog>

<div class="card" style="width: 50rem;">
    <div class="card-body">
        <h5 class="card-title">Scheduler</h5>
        <p class="card-text">Settings</p>

        <form (ngSubmit)="onSubmit()">
            <div class="mb-3">
                <label for="selectedYear" class="form-label">Months to view</label>
                <input type="number" class="form-control" id="selectedYear" name="selectedYear"
                       [(ngModel)]="schedulerSettings.yearToView">

                <label for="selectedMonth" class="form-label">Starting month to view</label>
                <input type="number" class="form-control" id="selectedMonth" name="selectedMonth"
                       [(ngModel)]="schedulerSettings.startMonthToView">

                <label for="selectedMonthsToView" class="form-label">No. of months to view</label>
                <input type="number" class="form-control" id="selectedMonthsToView" name="selectedMonthsToView"
                       [(ngModel)]="schedulerSettings.noOfMonthsToView">

            </div>
            <button type="submit" class="btn btn-primary">Change settings</button>
        </form>
    </div>
</div>


<!--div style="display:flex; zoom:150%">
  <div><img src="months.png" alt="months.png"/></div>
  <div><img src="months_v2.png" alt="months_v2.png"/></div>
</div-->
<div style="display:flex;justify-content: center;font-size: 20px;">{{ selectedPod.podName }} Pod</div>

<table class="scheduler">
    <div style='display:flex'>
        <div class='cell' style='width:180px;flex-shrink:0;'></div>
        @for (monthHeaderDto of monthHeaders; track monthHeaderDto.monthAsString) {
            <div class='cell monthHeader'
                 [style]="'width:'+monthHeaderDto.noOfDays*20+'px'">{{ monthHeaderDto.monthAsString }}
            </div>
        }
    </div>
    <div style='display:flex'>
        <div class='cell' style='width:180px;flex-shrink:0;'></div>

        @for (weekHeaderDto of weekHeaders; track weekHeaderDto.weekNumber) {
            <div class='cell weekHeader' [style]="'width:'+weekHeaderDto.noOfDays*20+'px'">
                cw{{ weekHeaderDto.weekNumber }}
            </div>
        }

    </div>
    <div style='display:flex'>
        <div class='cell' style='width:180px;flex-shrink:0;'></div>
        @for (dayHeaderDto of dayHeaders; track $index) {
            <div class='cell dayHeader'>{{ dayHeaderDto.day | date: 'd' }}</div>
        }
    </div>

    @for (schedulerView of schedulerViews; track schedulerView) {
        <div class='employeeRow'>
            <div class='cell employeeName'>pic: {{ schedulerView.user.name }}
                ({{ JSON.stringify(schedulerView.podMemberRoles) }})
            </div>

            @for (userCapacity of schedulerView.userCapacities; track userCapacity) {
                <!--div class='cell day weekDay' -->
                        <!--{{userCapacity.day}};{{userCapacity.dayAsStr}};{{DateUtils.isWeekend(userCapacity.day, userCapacity.dayAsStr)}}-->
                <div class='cell day '
                     [class]="{weekEnd: DateUtils.isWeekend(userCapacity.day, userCapacity.dayAsStr), weekDay: !DateUtils.isWeekend(userCapacity.day, userCapacity.dayAsStr) }">
                    <!--div class='cell day ' [class]="{weekEnd: isWeekEnd2(userCapacity.day | date: 'dd.MM.YYYY'), weekDay: !isWeekEnd2(userCapacity.day | date: 'dd.MM.YYYY') }"-->

                    <div style='height:100%;width:50%;'
                         class='daypart morning {{userCapacity.userBookedCapacity?.morningPod?.podStyleClass}} {{userCapacity.userAvailableCapacity?.morningAvailability?.availabilityTypeStyleClass}}'
                         title='{{userCapacity.userBookedCapacity?.morningPod?.podName}} {{userCapacity.userAvailableCapacity?.morningAvailability?.availabilityType}}'

                         (mousedown)="onDragStart($event,schedulerView.user, userCapacity, userCapacity.userBookedCapacity?.morningPod, userCapacity.userAvailableCapacity?.morningAvailability, null, null)"
                         (mouseup)="onDragEnd($event,schedulerView.user, userCapacity, userCapacity.userBookedCapacity?.morningPod, userCapacity.userAvailableCapacity?.morningAvailability, null, null)">
                    </div>
                    <div style='height:100%;width:50%;'
                         class='daypart afternoon {{userCapacity.userBookedCapacity?.afternoonPod?.podStyleClass}} {{userCapacity.userAvailableCapacity?.afternoonAvailability?.availabilityTypeStyleClass}}'
                         title='{{userCapacity.userBookedCapacity?.afternoonPod?.podName}} {{userCapacity.userAvailableCapacity?.afternoonAvailability?.availabilityType}}'

                         (mousedown)="onDragStart($event,schedulerView.user,userCapacity, null, null, userCapacity.userBookedCapacity?.afternoonPod, userCapacity.userAvailableCapacity?.afternoonAvailability)"
                         (mouseup)="onDragEnd($event,schedulerView.user,userCapacity, null, null, userCapacity.userBookedCapacity?.afternoonPod,userCapacity.userAvailableCapacity?.afternoonAvailability)">
                    </div>
                </div>
            }
        </div>
    }

</table>






